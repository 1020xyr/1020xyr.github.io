---
title: 内核版本切换记录
date: 2022-04-13 22:31:43
tags: 内核切换
categories: 内核驱动开发记录
---
<meta name="referrer" content="no-referrer" />


由于需要切换内核版本（4.19）并使用**相应版本源代码编译内核模块**，故在当前版本（5.10.3）下尝试编译内核，参考博客[如何编译 Linux 内核](https://linux.cn/article-9665-1.html)下载源代码进行编译，**但当前版本过高，复制当前版本的config文件后make总是会出现一系列奇怪的错误**，这可能是有些内核选项只适用于当前版本，而低版本不适用，故高版本的配置文件是不可用的。
```bash
cp /boot/config-$(uname -r) .config
```
所以采用另外一种方法进行内核编译：<mark>先安装版本近似的的内核安装包，而后进行源码编译</mark>

deb文件安装内核参考博客[Ubuntu Linux内核版本升级或降级到指定版本（基于ubuntu 18.04示例）](https://blog.csdn.net/weixin_42915431/article/details/106614841)
就拿4.19版本deb文件举例，在[https://kernel.ubuntu.com/~kernel-ppa/mainline/v4.19.100/](https://kernel.ubuntu.com/~kernel-ppa/mainline/v4.19.100/)中下载相应deb包
![](https://img-blog.csdnimg.cn/a11e350ceb8d4915a23a57fd18551a0e.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA5pyA5L2z5o2f5Y-LMTAyMA==,size_20,color_FFFFFF,t_70,g_se,x_16)
根据机器类型选择下载以下文件

```bash
  linux-headers-4.19.100-0419100_4.19.100-0419100.202001300442_all.deb
  linux-headers-4.19.100-0419100-generic_4.19.100-0419100.202001300442_amd64.deb
  linux-image-unsigned-4.19.100-0419100-generic_4.19.100-0419100.202001300442_amd64.deb
  linux-modules-4.19.100-0419100-generic_4.19.100-0419100.202001300442_amd64.deb
```
而后在下载文件夹中执行**dpkg -i *命令**进行安装，而后便参照上述博客进行内核切换即可

```bash
grep menuentry /boot/grub/grub.cfg  # 查看当前系统中内核的启动顺序
gedit /etc/default/grub # 修改内核启动顺序
update-grub # 更新grub配置
```


使用deb完成内核版本切换之后，再执行源码编译过程便没有报一些奇怪的错误

```bash
cp /boot/config-$(uname -r) .config
make menuconfig
make -j12
make modules_install -j12
sudo make install
```

**如有问题，望请告知，如果有用，记得点个赞^^**



