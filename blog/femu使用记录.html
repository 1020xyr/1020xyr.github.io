

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/nano-1.jpg">
  <link rel="icon" href="/img/nano-1.jpg">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="最佳损友1020">
  <meta name="keywords" content="">
  
    <meta name="description" content="Briefly speaking, FEMU is a fast, accurate, scalable, and extensible NVMe SSD Emulator. Based upon QEMU&#x2F;KVM, FEMU is exposed to Guest OS (Linux) as an NVMe block device (e.g. &#x2F;dev&#x2F;">
<meta property="og:type" content="article">
<meta property="og:title" content="femu使用记录">
<meta property="og:url" content="https://www.jiasun.top/blog/femu%E4%BD%BF%E7%94%A8%E8%AE%B0%E5%BD%95.html">
<meta property="og:site_name" content="最佳损友1020’s Blog">
<meta property="og:description" content="Briefly speaking, FEMU is a fast, accurate, scalable, and extensible NVMe SSD Emulator. Based upon QEMU&#x2F;KVM, FEMU is exposed to Guest OS (Linux) as an NVMe block device (e.g. &#x2F;dev&#x2F;">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://img-blog.csdnimg.cn/ffad2c30ae0c48b2958c58a58cfb370a.png">
<meta property="article:published_time" content="2023-05-09T02:25:13.000Z">
<meta property="article:modified_time" content="2024-02-22T09:06:23.292Z">
<meta property="article:author" content="最佳损友1020">
<meta property="article:tag" content="femu ssd zns">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://img-blog.csdnimg.cn/ffad2c30ae0c48b2958c58a58cfb370a.png">
  
  
  
  <title>femu使用记录 - 最佳损友1020’s Blog</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  



  
<link rel="stylesheet" href="/css/csdn.css">
<link rel="stylesheet" href="/css/top.css">



  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"www.jiasun.top","root":"/","version":"1.9.5-a","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":4},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":true,"follow_dnt":true,"baidu":null,"google":{"measurement_id":null},"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":"n227FxNJCTncCeI3DrGx7MnC-gzGzoHsz","app_key":"ljkRZDiTtVmjn5mpaQmpFqgv","server_url":"https://n227fxnj.lc-cn-n1-shared.com","path":"window.location.pathname","ignore_local":false}},"search_path":"/local-search.xml","include_content_in_search":true};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  

  

  
    <!-- Google tag (gtag.js) -->
    <script async>
      if (!Fluid.ctx.dnt) {
        Fluid.utils.createScript("https://www.googletagmanager.com/gtag/js?id=", function() {
          window.dataLayer = window.dataLayer || [];
          function gtag() {
            dataLayer.push(arguments);
          }
          gtag('js', new Date());
          gtag('config', '');
        });
      }
    </script>
  

  

  

  

  
    
  



  
<!-- hexo injector head_end start -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hexo-math@4.0.0/dist/style.css">
<!-- hexo injector head_end end --><meta name="generator" content="Hexo 6.3.0"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>最佳损友1020</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                <span>首页</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                <span>归档</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                <span>分类</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                <span>标签</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                <span>关于</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/links/">
                <i class="iconfont icon-link-fill"></i>
                <span>友链</span>
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              <i class="iconfont icon-search"></i>
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">
              <i class="iconfont icon-dark" id="color-toggle-icon"></i>
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('/img/bg.webp') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="femu使用记录"></span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2023-05-09 10:25" pubdate>
          2023年5月9日 上午
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          22k 字
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          183 分钟
        
      </span>
    

    
    
      
        <span id="leancloud-page-views-container" class="post-meta" style="display: none">
          <i class="iconfont icon-eye" aria-hidden="true"></i>
          <span id="leancloud-page-views"></span> 次
        </span>
        
      
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <h1 id="seo-header">femu使用记录</h1>
            
            
              <div class="markdown-body">
                
                <meta name="referrer" content="no-referrer" />


<!-- toc -->
<blockquote>
<p>Briefly speaking, FEMU is a fast, accurate, scalable, and extensible NVMe SSD Emulator. Based upon QEMU&#x2F;KVM, FEMU is exposed to Guest OS (Linux) as an NVMe block device (e.g. &#x2F;dev&#x2F;nvme0nX). It supports emulating different types of SSDs</p>
</blockquote>
<p>这篇博客用于记录femu搭建与使用过程中遇到的问题，持续更新</p>
<h2 id="环境搭建"><a href="#环境搭建" class="headerlink" title="环境搭建"></a>环境搭建</h2><p>首先是搭建环境，刚开始按照博客<a target="_blank" rel="noopener" href="https://blog.csdn.net/bijie1196/article/details/120752319">安装FEMU，并使用FEMU模拟SSD黑盒、OCSSD、NoSSD。</a>，自己制作镜像，但失败了，故选择第一种方法，下载femu提供的镜像，下载完成后直接运行run_zns.sh脚本，不需要第二种方法的安装操作系统，修改grub等操作</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 邮件内容</span><br>Hi,<br>Thank you again <span class="hljs-keyword">for</span> your interest <span class="hljs-keyword">in</span> FEMU!<br>The tarball size is 1.4GB. After decompression, the VM image file size is ~14GB.<br>Downloading and decompression might take a <span class="hljs-keyword">while</span> depending on your Internet<br>connection speed and CPU processing capability. Please <span class="hljs-built_in">wait</span> patiently!<br>Below are the steps to download, decompress, and verify the FEMU VM image.<br><span class="hljs-built_in">mkdir</span> -p ~/images<br><span class="hljs-built_in">cd</span> ~/images<br>wget http://people.cs.uchicago.edu/~huaicheng/femu/femu-vm.tar.xz<br>tar xJvf femu-vm.tar.xz<br>After these steps, you will get two files: <span class="hljs-string">&quot;u20s.qcow2&quot;</span> and <span class="hljs-string">&quot;u20s.md5sum&quot;</span>.<br>You can verify the integrity of the VM image file by doing:<br><span class="hljs-built_in">md5sum</span> u20s.qcow2 &gt; tmp.md5sum<br>diff tmp.md5sum u20s.md5sum<br>If diff complains that the above two files differ, <span class="hljs-keyword">then</span> the VM image file is<br>corrupted. Please redo the above steps.<br>The user account and guest OS of the VM:<br>- username: femu<br>- passwd : femu<br>- Guest OS: Ubuntu 20.04.1 server, with kernel 5.4<br>If you think FEMU is useful to your project, we appreciate you could consider<br>starring the FEMU github repo to support us, thanks!<br>Best,<br>Huaicheng<br></code></pre></td></tr></table></figure>
<p>以root权限运行nvme list能看到zns ssd，则表示搭建环境成功</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">root@fvm /h/f/libnvme (master)<span class="hljs-comment"># nvme  list</span><br>Node                  SN                   Model                                    Namespace Usage                      Format           FW Rev  <br>--------------------- -------------------- ---------------------------------------- --------- -------------------------- ---------------- --------<br>/dev/nvme0n1          vZNSSD0              FEMU ZNS-SSD Controller                  1           4.29  GB /   4.29  GB    512   B +  0 B   1.0     <br></code></pre></td></tr></table></figure>
<p>可使用ssh连接虚拟机，端口号即为hostfwd定义的端口号（8080），vscode连接更方便</p>
<p><strong>自己制作镜像经验</strong><br>源码编译qemu</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash">sudo apt-get install git fakeroot build-essential ncurses-dev xz-utils libssl-dev bc flex libelf-dev bison meson<br>wget https://download.qemu.org/qemu-8.0.0.tar.xz<br>tar xvJf qemu-8.0.0.tar.xz<br><span class="hljs-built_in">cd</span> qemu-8.0.0<br>./configure --enable-kvm --enable-debug --enable-vnc --enable-werror  --target-list=<span class="hljs-string">&quot;x86_64-softmmu&quot;</span> --enable-sdl<br>make<br>make install<br></code></pre></td></tr></table></figure>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_36393978/article/details/118353939">qemu运行虚拟机无反应，只输出一行提示信息:VNC server running on 127.0.0.1:5900</a></p>
<h2 id="libnvme：libnvme-so-1-cannot-open-shared-object-file-No-such-file-or-directory"><a href="#libnvme：libnvme-so-1-cannot-open-shared-object-file-No-such-file-or-directory" class="headerlink" title="libnvme：libnvme.so.1: cannot open shared object file: No such file or directory"></a>libnvme：libnvme.so.1: cannot open shared object file: No such file or directory</h2><p><a target="_blank" rel="noopener" href="https://github.com/linux-nvme/libnvme">libnvme</a></p>
<blockquote>
<p>This is the libnvme development C library. libnvme provides type definitions for NVMe specification structures, enumerations, and bit fields, helper functions to construct, dispatch, and decode commands and payloads, and utilities to connect, scan, and manage nvme devices on a Linux system.</p>
</blockquote>
<p>使用以下命令编译源文件</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">gcc zns_rw.c -o zns_rw  -lnvme<br></code></pre></td></tr></table></figure>
<p>执行</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">./zns_rw<br>./zns_rw: error <span class="hljs-keyword">while</span> loading shared libraries: libnvme.so.1: cannot open shared object file: No such file or directory<br></code></pre></td></tr></table></figure>
<p>使用ldd列出文件依赖的动态库</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">ldd zns_rw<br>        linux-vdso.so.1 (0x00007ffe90b75000)<br>        libnvme.so.1 =&gt; not found<br>        libc.so.6 =&gt; /lib/x86_64-linux-gnu/libc.so.6 (0x00007f396cb49000)<br>        /lib64/ld-linux-x86-64.so.2 (0x00007f396cd49000)<br></code></pre></td></tr></table></figure>
<p>也就是说链接器不知道去哪找到libnvme.so.1，查看libnvme库install的输出</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs bash">meson install -C .build<br>ninja: Entering directory `.build<span class="hljs-string">&#x27;</span><br><span class="hljs-string">ninja: no work to do.</span><br><span class="hljs-string">Installing src/libnvme.so.1.4.0 to /usr/local/lib64</span><br><span class="hljs-string">Installing src/libnvme-mi.so.1.4.0 to /usr/local/lib64</span><br><span class="hljs-string">Installing /home/femu/libnvme/src/libnvme.h to /usr/local/include</span><br><span class="hljs-string">Installing /home/femu/libnvme/src/libnvme-mi.h to /usr/local/include</span><br><span class="hljs-string">Installing /home/femu/libnvme/src/nvme/api-types.h to /usr/local/include/nvme</span><br><span class="hljs-string">Installing /home/femu/libnvme/src/nvme/fabrics.h to /usr/local/include/nvme</span><br><span class="hljs-string">Installing /home/femu/libnvme/src/nvme/filters.h to /usr/local/include/nvme</span><br><span class="hljs-string">Installing /home/femu/libnvme/src/nvme/ioctl.h to /usr/local/include/nvme</span><br><span class="hljs-string">Installing /home/femu/libnvme/src/nvme/linux.h to /usr/local/include/nvme</span><br><span class="hljs-string">Installing /home/femu/libnvme/src/nvme/log.h to /usr/local/include/nvme</span><br><span class="hljs-string">Installing /home/femu/libnvme/src/nvme/nbft.h to /usr/local/include/nvme</span><br><span class="hljs-string">Installing /home/femu/libnvme/src/nvme/tree.h to /usr/local/include/nvme</span><br><span class="hljs-string">Installing /home/femu/libnvme/src/nvme/types.h to /usr/local/include/nvme</span><br><span class="hljs-string">Installing /home/femu/libnvme/src/nvme/util.h to /usr/local/include/nvme</span><br><span class="hljs-string">Installing /home/femu/libnvme/src/nvme/mi.h to /usr/local/include/nvme</span><br><span class="hljs-string">Installing /home/femu/libnvme/.build/meson-private/libnvme.pc to /usr/local/lib64/pkgconfig</span><br><span class="hljs-string">Installing /home/femu/libnvme/.build/meson-private/libnvme-mi.pc to /usr/local/lib64/pkgconfig</span><br></code></pre></td></tr></table></figure>
<p>故设置动态库路径为&#x2F;usr&#x2F;local&#x2F;lib64重新编译</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">gcc zns_rw.c -o zns_rw  -lnvme -L /usr/local/lib64/ -Wl,-rpath=/usr/local/lib64/<br>ldd zns_rw<br>        linux-vdso.so.1 (0x00007ffe233b1000)<br>        libnvme.so.1 =&gt; /usr/local/lib64/libnvme.so.1 (0x00007fc367ee5000)<br>        libc.so.6 =&gt; /lib/x86_64-linux-gnu/libc.so.6 (0x00007fc367cec000)<br>        /lib64/ld-linux-x86-64.so.2 (0x00007fc367f1d000)<br></code></pre></td></tr></table></figure>

<p>-L选项告诉链接器在链接时寻找动态库的路径<br>-Wl,-rpath选项告诉链接器在运行时寻找动态库的路径</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs bash"> man gcc | grep <span class="hljs-string">&quot;Wl&quot;</span><br>       -Wl,option<br>           Pass option as an option to the linker.  If option contains commas, it is <span class="hljs-built_in">split</span> into multiple options at the commas.  You can use this syntax to pass an argument to the option.  For example, -Wl,-Map,output.map passes -Map output.map to the<br>           linker.  When using the GNU linker, you can also get the same effect with -Wl,-Map=output.map.<br>           <br>ld --<span class="hljs-built_in">help</span> | grep <span class="hljs-string">&quot;rpath&quot;</span><br>                              Just <span class="hljs-built_in">link</span> symbols (<span class="hljs-keyword">if</span> directory, same as --rpath)<br>  -rpath PATH                 Set runtime shared library search path<br>  -rpath-link PATH            Set <span class="hljs-built_in">link</span> time shared library search path<br></code></pre></td></tr></table></figure>

<p>相关博客<br><a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/6562403/i-dont-understand-wl-rpath-wl">I don’t understand -Wl,-rpath -Wl,</a><br><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/183071070#:~:text=%E4%B8%89%E3%80%81%E9%9D%99%E6%80%81%E5%BA%93%E5%92%8C%E5%8A%A8%E6%80%81%E5%BA%93%201%20ELF%E5%8F%AF%E6%89%A7%E8%A1%8C%E6%96%87%E4%BB%B6%E4%B8%AD%E5%8A%A8%E6%80%81%E6%AE%B5DT_PATH%E6%8C%87%E5%AE%9A%EF%BC%9Bgcc%E5%8A%A0%E5%85%A5%E8%BF%9E%E6%8E%A5%E5%8F%82%E6%95%B0%E2%80%9C-Wl,-rpath%E2%80%9D%E6%8C%87%E5%AE%9A%E5%8A%A8%E6%80%81%E5%BA%93%E6%90%9C%E7%B4%A2%E8%B7%AF%E5%BE%84%EF%BC%8C%E5%A4%9A%E4%B8%AA%E8%B7%AF%E5%BE%84%E4%B9%8B%E9%97%B4%E7%94%A8%E5%86%92%E5%8F%B7%E5%88%86%E9%9A%94%EF%BC%9B%202%20%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8FLD_LIBRARY_PATH%E6%8C%87%E5%AE%9A%E8%B7%AF%E5%BE%84%EF%BC%9B%203,/etc/ld.so.cache%E4%B8%AD%E7%BC%93%E5%AD%98%E7%9A%84%E5%8A%A8%E6%80%81%E5%BA%93%E8%B7%AF%E5%BE%84%E3%80%82%20%E9%80%9A%E8%BF%87%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6/etc/ld.so.conf%E5%A2%9E%E5%88%A0%E8%B7%AF%E5%BE%84%EF%BC%88%E4%BF%AE%E6%94%B9%E5%90%8E%E9%9C%80%E8%A6%81%E8%BF%90%E8%A1%8Cldconfig%E5%91%BD%E4%BB%A4%EF%BC%89%EF%BC%9B%204%20/lib/%205%20/usr/lib/">gcc编译过程、gcc命令参数、静态库和动态库搜索路径</a><br><a href="https://www.jiasun.top/blog/%E3%80%8Ac%E4%B8%93%E5%AE%B6%E7%BC%96%E7%A8%8B%E3%80%8B%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0.html">《c专家编程》读书笔记：第五章 对链接的思考</a></p>
<h2 id="调试方法"><a href="#调试方法" class="headerlink" title="调试方法"></a>调试方法</h2><p>一：重新编译femu，在femu-compile.sh configure后加上<code>--enable-debug</code>选项，保证优化等级为-O0</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 编译输出</span><br>  Compilation<br>    host CPU                     : x86_64<br>    host endianness              : little<br>    C compiler                   : cc -m64 -mcx16<br>    Host C compiler              : cc -m64 -mcx16<br>    C++ compiler                 : c++ -m64 -mcx16<br>    CFLAGS                       : -g -O0<br>    CXXFLAGS                     : -g -O0<br></code></pre></td></tr></table></figure>
<p>二：gdb运行程序</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs bash"> gdb --args  x86_64-softmmu/qemu-system-x86_64 \<br>                                            -name <span class="hljs-string">&quot;FEMU-ZNSSD-VM&quot;</span> \<br>                                            -enable-kvm \<br>                                            -cpu host \<br>                                            -smp 4 \<br>                                            -m 4G \<br>                                            -device virtio-scsi-pci,<span class="hljs-built_in">id</span>=scsi0 \<br>                                            -device scsi-hd,drive=hd0 \<br>                                            -drive file=/root/images/u20s.qcow2,<span class="hljs-keyword">if</span>=none,aio=native,cache=none,format=qcow2,<span class="hljs-built_in">id</span>=hd0 \<br>                                            -device femu,devsz_mb=4096,femu_mode=3 \<br>                                            -net user,hostfwd=tcp::8080-:22 \<br>                                            -net nic,model=virtio \<br>                                            -nographic \<br>                                            -qmp unix:./qmp-sock,server,nowait 2&gt;&amp;1 | <span class="hljs-built_in">tee</span> <span class="hljs-built_in">log</span><br>(gdb) handle SIGUSR1 nostop<br>Signal        Stop      Print   Pass to program Description<br>SIGUSR1       No        Yes     Yes             User defined signal 1<br></code></pre></td></tr></table></figure>
<p>三： 调试演示<br>而后就是常规的gdb操作了，拿一个错误的程序来调试<br><img src="https://img-blog.csdnimg.cn/8ad8a310603449978eb55174056102c4.png" srcset="/img/loading.gif" lazyload></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">(gdb) b zns.c:1110<br>Breakpoint 1 at 0x489f0b: file ../hw/femu/zns/zns.c, line 1110.<br>(gdb) r<br><span class="hljs-comment"># 开启虚拟机</span><br></code></pre></td></tr></table></figure>



<p>错误的读写测试代码</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">// SPDX-License-Identifier: LGPL-2.1-or-later</span><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * This file is part of libnvme.</span><br><span class="hljs-comment"> * Copyright (c) 2020 Western Digital Corporation or its affiliates.</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * Authors: Keith Busch &lt;keith.busch@wdc.com&gt;</span><br><span class="hljs-comment"> */</span><br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * Search out for ZNS type namespaces, and if found, report their properties.</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;string.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdbool.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdlib.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;libnvme.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;inttypes.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;errno.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> TEST_SIZE (4096)</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> TEST_BLOCK (8)</span><br><br><span class="hljs-type">static</span> <span class="hljs-type">void</span> <span class="hljs-title function_">rw_test</span><span class="hljs-params">(<span class="hljs-type">nvme_ns_t</span> n)</span> &#123;<br>  <span class="hljs-type">char</span> write_data[TEST_SIZE];<br>  <span class="hljs-type">char</span> read_data[TEST_SIZE];<br>  <span class="hljs-built_in">memset</span>(write_data, <span class="hljs-number">0x12</span>, TEST_SIZE);<br>  <span class="hljs-built_in">memset</span>(read_data, <span class="hljs-number">0x34</span>, TEST_SIZE);<br>  <span class="hljs-type">int</span> fd = nvme_ns_get_fd(n);<br>  <span class="hljs-type">int</span> nsid = nvme_ns_get_nsid(n);<br>  <span class="hljs-type">uint64_t</span> req_res;<br><br>  <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">nvme_zns_append_args</span> <span class="hljs-title">arg</span>;</span><br>  arg.data = write_data;<br>  arg.data_len = TEST_SIZE;<br>  arg.fd = fd;<br>  arg.nsid = nsid;<br>  arg.nlb = TEST_BLOCK;<br>  arg.zslba = <span class="hljs-number">0</span>;<br>  arg.result = &amp;req_res;<br>  arg.args_size = <span class="hljs-keyword">sizeof</span>(arg);<br>  arg.timeout = <span class="hljs-number">1000</span>;<br><br>  <span class="hljs-type">int</span> ret = nvme_zns_append(&amp;arg);<br>  <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;ret:%d req res:%lx erron:%d\n&quot;</span>, ret, req_res, errno);<br>&#125;<br><br><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span> &#123;<br>  <span class="hljs-type">nvme_subsystem_t</span> s;<br>  <span class="hljs-type">nvme_root_t</span> r;<br>  <span class="hljs-type">nvme_host_t</span> h;<br>  <span class="hljs-type">nvme_ctrl_t</span> c;<br>  <span class="hljs-type">nvme_ns_t</span> n;<br><br>  r = nvme_scan(<span class="hljs-literal">NULL</span>);<br>  <span class="hljs-keyword">if</span> (!r) <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;<br><br>  nvme_for_each_host(r, h) &#123;<br>    nvme_for_each_subsystem(h, s) &#123;<br>      nvme_subsystem_for_each_ctrl(s, c) &#123;<br>        nvme_ctrl_for_each_ns(c, n) &#123;<br>          <span class="hljs-keyword">if</span> (nvme_ns_get_csi(n) == NVME_CSI_ZNS) &#123;<br>            rw_test(n);<br>          &#125;<br>        &#125;<br>      &#125;<br>    &#125;<br>  &#125;<br>  nvme_free_tree(r);<br>&#125;<br><br></code></pre></td></tr></table></figure>
<p>在虚拟机中执行该程序（用vscode连接8080端口）<br><img src="https://img-blog.csdnimg.cn/ff858f9276e1477ca33ad8882d1f1fa3.png" srcset="/img/loading.gif" lazyload></p>
<p>gdb显示</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs c">Ubuntu <span class="hljs-number">20.04</span><span class="hljs-number">.1</span> LTS fvm ttyS0<br><br>fvm login: [Switching to Thread <span class="hljs-number">0x7ffff5c2d700</span> (LWP <span class="hljs-number">423223</span>)]<br><br>Thread <span class="hljs-number">9</span> <span class="hljs-string">&quot;qemu-system-x86&quot;</span> hit Breakpoint <span class="hljs-number">1</span>, zns_do_write (n=<span class="hljs-number">0x555557cae9d0</span>, req=<span class="hljs-number">0x7ffedc36a3a0</span>, append=<span class="hljs-literal">true</span>, wrz=<span class="hljs-literal">false</span>) at ../hw/femu/zns/zns.c:<span class="hljs-number">1110</span><br><span class="hljs-number">1110</span>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;****************Append Failed***************\n&quot;</span>);<br>(gdb) p/x status<br>$<span class="hljs-number">1</span> = <span class="hljs-number">0x4002</span><br>(gdb) <br></code></pre></td></tr></table></figure>


<p><mark>也可以在执行测试程序前再打断点</mark><br>类似于以下操作步骤</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash">Thread 1 <span class="hljs-string">&quot;qemu-system-x86&quot;</span> received signal SIGINT, Interrupt.<br>0x00007ffff75c2a96 <span class="hljs-keyword">in</span> __ppoll (fds=0x555556f074a0, nfds=20, <span class="hljs-built_in">timeout</span>=&lt;optimized out&gt;, sigmask=0x0) at ../sysdeps/unix/sysv/linux/ppoll.c:44<br>44      ../sysdeps/unix/sysv/linux/ppoll.c: 没有那个文件或目录.<br>(gdb) b zns_do_write<br>Breakpoint 1 at 0x5555559ddcab: file ../hw/femu/zns/zns.c, line 1051.<br>(gdb) c<br>Continuing.<br>[Switching to Thread 0x7ffff5c2d700 (LWP 426245)]<br><br>Thread 9 <span class="hljs-string">&quot;qemu-system-x86&quot;</span> hit Breakpoint 1, zns_do_write (n=0x1, req=0x7ffedc0eb000, append=<span class="hljs-literal">false</span>, wrz=<span class="hljs-literal">true</span>) at ../hw/femu/zns/zns.c:1051<br>1051    &#123;<br></code></pre></td></tr></table></figure>
<p>通过debug，找到了程序中错误所在（nlb是一个基于0的值，实际值需减一）</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">// SPDX-License-Identifier: LGPL-2.1-or-later</span><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * This file is part of libnvme.</span><br><span class="hljs-comment"> * Copyright (c) 2020 Western Digital Corporation or its affiliates.</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * Authors: Keith Busch &lt;keith.busch@wdc.com&gt;</span><br><span class="hljs-comment"> */</span><br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * Search out for ZNS type namespaces, and if found, report their properties.</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;string.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdbool.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdlib.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;libnvme.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;inttypes.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;errno.h&gt;</span></span><br><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> TEST_SIZE (4096)</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> TEST_BLOCK (8 - 1)</span><br><br><span class="hljs-type">static</span> <span class="hljs-type">void</span> <span class="hljs-title function_">rw_test</span><span class="hljs-params">(<span class="hljs-type">nvme_ns_t</span> n)</span> &#123;<br>  <span class="hljs-type">char</span> write_data[TEST_SIZE];<br>  <span class="hljs-type">char</span> read_data[TEST_SIZE];<br>  <span class="hljs-built_in">memset</span>(write_data, <span class="hljs-number">0x12</span>, TEST_SIZE);<br>  <span class="hljs-built_in">memset</span>(read_data, <span class="hljs-number">0x34</span>, TEST_SIZE);<br>  __u64 slba = <span class="hljs-number">0x140000</span>;<br>  <span class="hljs-type">int</span> fd = nvme_ns_get_fd(n);<br>  <span class="hljs-type">int</span> nsid = nvme_ns_get_nsid(n);<br>  <span class="hljs-type">int</span> ret = <span class="hljs-number">0</span>;<br><br>  <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">nvme_zns_append_args</span> <span class="hljs-title">append_arg</span>;</span><br>  __u64 append_cq = <span class="hljs-number">0x0</span>;<br>  <span class="hljs-built_in">memset</span>(&amp;append_arg, <span class="hljs-number">0x0</span>, <span class="hljs-keyword">sizeof</span>(append_arg));<br>  append_arg.zslba = slba;<br>  append_arg.result = &amp;append_cq;<br>  append_arg.data = write_data;<br>  append_arg.data_len = TEST_SIZE;<br>  append_arg.fd = fd;<br>  append_arg.nsid = nsid;<br>  append_arg.nlb = TEST_BLOCK;<br>  append_arg.args_size = <span class="hljs-keyword">sizeof</span>(append_arg);<br>  append_arg.timeout = <span class="hljs-number">1000</span>;<br><br>  ret = nvme_zns_append(&amp;append_arg);<br>  <span class="hljs-keyword">if</span> (ret != <span class="hljs-number">0</span>) &#123;<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;append failed. ret:%d req res:%llx erron:%d\n&quot;</span>, ret, append_cq, errno);<br>  &#125;<br>  <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;append cq:%llx\n&quot;</span>, append_cq);<br><br>  <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;berfore\n&quot;</span>);<br>  <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10</span>; i++) &#123;<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%x &quot;</span>, read_data[i]);<br>  &#125;<br><br>  <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">nvme_io_args</span> <span class="hljs-title">read_arg</span>;</span><br>  <span class="hljs-built_in">memset</span>(&amp;read_arg, <span class="hljs-number">0x0</span>, <span class="hljs-keyword">sizeof</span>(read_arg));<br>  __u32 read_cq = <span class="hljs-number">0x0</span>;<br>  read_arg.slba = slba;<br>  read_arg.result = &amp;read_cq;<br>  read_arg.data = read_data;<br>  read_arg.data_len = TEST_SIZE;<br>  read_arg.args_size = <span class="hljs-keyword">sizeof</span>(read_arg);<br>  read_arg.nsid = nsid;<br>  read_arg.fd = fd;<br>  read_arg.nlb = TEST_BLOCK;<br>  read_arg.timeout = <span class="hljs-number">1000</span>;<br><br>  ret = nvme_read(&amp;read_arg);<br>  <span class="hljs-keyword">if</span> (ret != <span class="hljs-number">0</span>) &#123;<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;read failed. ret:%d req res:%x erron:%d\n&quot;</span>, ret, read_cq, errno);<br>  &#125;<br>  <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;\nread cq:%x\n&quot;</span>, read_cq);<br><br>  <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;after\n&quot;</span>);<br>  <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10</span>; i++) &#123;<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%x &quot;</span>, read_data[i]);<br>  &#125;<br>&#125;<br><br><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span> &#123;<br>  <span class="hljs-type">nvme_subsystem_t</span> s;<br>  <span class="hljs-type">nvme_root_t</span> r;<br>  <span class="hljs-type">nvme_host_t</span> h;<br>  <span class="hljs-type">nvme_ctrl_t</span> c;<br>  <span class="hljs-type">nvme_ns_t</span> n;<br><br>  r = nvme_scan(<span class="hljs-literal">NULL</span>);<br>  <span class="hljs-keyword">if</span> (!r) <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;<br><br>  nvme_for_each_host(r, h) &#123;<br>    nvme_for_each_subsystem(h, s) &#123;<br>      nvme_subsystem_for_each_ctrl(s, c) &#123;<br>        nvme_ctrl_for_each_ns(c, n) &#123;<br>          <span class="hljs-keyword">if</span> (nvme_ns_get_csi(n) == NVME_CSI_ZNS) &#123;<br>            rw_test(n);<br>          &#125;<br>        &#125;<br>      &#125;<br>    &#125;<br>  &#125;<br>  nvme_free_tree(r);<br>&#125;<br><br><span class="hljs-comment">/*</span><br><span class="hljs-comment">nvme zns report-zones /dev/nvme0n1</span><br><span class="hljs-comment">nr_zones: 32</span><br><span class="hljs-comment">SLBA: 0x0        WP: 0x0        Cap: 0x40000    State: EMPTY        Type: SEQWRITE_REQ   Attrs: 0x0</span><br><span class="hljs-comment">SLBA: 0x40000    WP: 0x40000    Cap: 0x40000    State: EMPTY        Type: SEQWRITE_REQ   Attrs: 0x0</span><br><span class="hljs-comment">SLBA: 0x80000    WP: 0x80000    Cap: 0x40000    State: EMPTY        Type: SEQWRITE_REQ   Attrs: 0x0</span><br><span class="hljs-comment">SLBA: 0xc0000    WP: 0xc0000    Cap: 0x40000    State: EMPTY        Type: SEQWRITE_REQ   Attrs: 0x0</span><br><span class="hljs-comment">SLBA: 0x100000   WP: 0x100000   Cap: 0x40000    State: EMPTY        Type: SEQWRITE_REQ   Attrs: 0x0</span><br><span class="hljs-comment">SLBA: 0x140000   WP: 0x140000   Cap: 0x40000    State: EMPTY        Type: SEQWRITE_REQ   Attrs: 0x0</span><br><span class="hljs-comment">SLBA: 0x180000   WP: 0x180000   Cap: 0x40000    State: EMPTY        Type: SEQWRITE_REQ   Attrs: 0x0</span><br><span class="hljs-comment">SLBA: 0x1c0000   WP: 0x1c0000   Cap: 0x40000    State: EMPTY        Type: SEQWRITE_REQ   Attrs: 0x0</span><br><span class="hljs-comment">...</span><br><span class="hljs-comment">*/</span><br></code></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash">gcc zns_rw.c -o zns_rw  -lnvme -L /usr/local/lib64/ -Wl,-rpath=/usr/local/lib64/ <br>./zns_rw<br>append cq:140000<br>berfore<br>34 34 34 34 34 34 34 34 34 34 <br><span class="hljs-built_in">read</span> cq:0<br>after<br>12 12 12 12 12 12 12 12 12 12<br></code></pre></td></tr></table></figure>

<p>四：解决问题的经历<br>1 刚开始的时候想要调试femu，就想使用6.081 qemu调试内核的方式，但也不知道符号表在哪，并且femu虚拟出来的是一个IO设备，总觉得和调试内核有点不一样，后面看到<a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_41146650/article/details/127279700">博客qemu侧 块设备调试记录（一）</a>，具体内容没怎么看，只是发现原来可以直接将qemu当作可执行程序来调试，故用同样的方法试了试femu，发现可以。<br>2 gdb运行的时候时不时有输出 “Program received signal SIGUSR1, User defined signal 1.” 打断运行，故执行“handle SIGUSR1  nostop”，使得用户定义中断不停止运行。<br>3 错误击中断点时用bt发现各个变量都优化掉了“optimized out”，故需要修改编译选项<br>看到执行femu-compile.sh的输出中有如下信息</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs c">Compilation<br>  host CPU                     : x86_64<br>  host endianness              : little<br>  C compiler                   : cc -m64 -mcx16<br>  Host C compiler              : cc -m64 -mcx16<br>  C++ compiler                 : c++ -m64 -mcx16<br>  CFLAGS                       : -g -O2<br>  CXXFLAGS                     : -g -O2<br></code></pre></td></tr></table></figure>
<p>全局搜索Compilation,-O,optimization等相关信息，然后一步一步倒退终于看到了相应的选项 –enable-debug</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs bash">// meson.build<br>option_cflags = (get_option(<span class="hljs-string">&#x27;debug&#x27;</span>) ? [<span class="hljs-string">&#x27;-g&#x27;</span>] : [])<br><span class="hljs-keyword">if</span> get_option(<span class="hljs-string">&#x27;optimization&#x27;</span>) != <span class="hljs-string">&#x27;plain&#x27;</span><br>  option_cflags += [<span class="hljs-string">&#x27;-O&#x27;</span> + get_option(<span class="hljs-string">&#x27;optimization&#x27;</span>)]<br>endif<br><br> // configure<br> --enable-debug)<br>      <span class="hljs-comment"># Enable debugging options that aren&#x27;t excessively noisy</span><br>      debug_tcg=<span class="hljs-string">&quot;yes&quot;</span><br>      meson_option_parse --enable-debug-mutex <span class="hljs-string">&quot;&quot;</span><br>      meson_option_add -Doptimization=0<br>      fortify_source=<span class="hljs-string">&quot;no&quot;</span><br>      <br>加上 --enable-debug选项后<br>  Compilation<br>    host CPU                     : x86_64<br>    host endianness              : little<br>    C compiler                   : cc -m64 -mcx16<br>    Host C compiler              : cc -m64 -mcx16<br>    C++ compiler                 : c++ -m64 -mcx16<br>    CFLAGS                       : -g -O0<br>    CXXFLAGS                     : -g -O0<br></code></pre></td></tr></table></figure>

<h2 id="Zone-Append-Size-Limit-ZASL"><a href="#Zone-Append-Size-Limit-ZASL" class="headerlink" title="Zone Append Size Limit (ZASL)"></a>Zone Append Size Limit (ZASL)</h2><p><img src="https://img-blog.csdnimg.cn/07e7c3e60eb1468e805938b0f526059b.png" srcset="/img/loading.gif" lazyload><br>用程序测试并发读写，随机生成写入的扇区数，发现femu输出</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">****************Append Failed***************<br>Error IO processed!<br></code></pre></td></tr></table></figure>
<p>加上打印status</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs c">err:<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;****************Append Failed***************\n&quot;</span>);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;status:%x\n&quot;</span>,status);<br>    <span class="hljs-keyword">return</span> status | NVME_DNR;<br>    <br><span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (status == NVME_SUCCESS) &#123;<br>            <span class="hljs-comment">/* Normal I/Os that don&#x27;t need delay emulation */</span><br>            req-&gt;status = status;<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            femu_err(<span class="hljs-string">&quot;Error IO processed! status is %x\n&quot;</span>,status);<br>        &#125;<br></code></pre></td></tr></table></figure>
<p>发现status为0x2 （NVME_INVALID_FIELD），通过gdb发现出错的代码行</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs c">zns_check_zone_write：<br><span class="hljs-keyword">if</span> (zns_l2b(ns, nlb) &gt; (n-&gt;page_size &lt;&lt; n-&gt;zasl)) &#123;<br>    status = NVME_INVALID_FIELD;<br>&#125;<br><br>(gdb) p n-&gt;page_size <br>$<span class="hljs-number">10</span> = <span class="hljs-number">4096</span><br>(gdb)p n-&gt;zasl <br>$<span class="hljs-number">11</span> = <span class="hljs-number">5</span> <span class="hljs-string">&#x27;\005&#x27;</span><br>(gdb)p n-&gt;page_size &lt;&lt; n-&gt;zasl <br>$<span class="hljs-number">12</span> = <span class="hljs-number">131072</span><br></code></pre></td></tr></table></figure>
<p>所以写入数据大小应该小于等于128KB</p>
<p>倒退到其定义过程</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">static</span> <span class="hljs-type">int</span> <span class="hljs-title function_">zns_start_ctrl</span><span class="hljs-params">(FemuCtrl *n)</span><br>&#123;<br>    <span class="hljs-comment">/* Coperd: let&#x27;s fail early before anything crazy happens */</span><br>    assert(n-&gt;page_size == <span class="hljs-number">4096</span>);<br><br>    <span class="hljs-keyword">if</span> (!n-&gt;zasl_bs) &#123;<br>        n-&gt;zasl = n-&gt;mdts;<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-keyword">if</span> (n-&gt;zasl_bs &lt; n-&gt;page_size) &#123;<br>            femu_err(<span class="hljs-string">&quot;ZASL too small (%dB), must &gt;= 1 page (4K)\n&quot;</span>, n-&gt;zasl_bs);<br>            <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;<br>        &#125;<br>        n-&gt;zasl = <span class="hljs-number">31</span> - clz32(n-&gt;zasl_bs / n-&gt;page_size);<br>    &#125;<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br><br>(gdb) p n-&gt;zasl_bs<br>$<span class="hljs-number">4</span> = <span class="hljs-number">131072</span><br>(gdb) p clz32(n-&gt;zasl_bs / n-&gt;page_size)<br>$<span class="hljs-number">5</span> = <span class="hljs-number">26</span><br>(gdb) p n-&gt;zasl_bs / n-&gt;page_size<br>$<span class="hljs-number">6</span> = <span class="hljs-number">32</span><br><br><span class="hljs-type">static</span> <span class="hljs-type">int</span> zns_init_zone_cap(FemuCtrl *n)<br>&#123;<br>    n-&gt;zoned = <span class="hljs-literal">true</span>;<br>    n-&gt;zasl_bs = NVME_DEFAULT_MAX_AZ_SIZE;<br>    n-&gt;zone_size_bs = NVME_DEFAULT_ZONE_SIZE;<br>    n-&gt;zone_cap_bs = <span class="hljs-number">0</span>;<br>    n-&gt;cross_zone_read = <span class="hljs-literal">false</span>;<br>    n-&gt;max_active_zones = <span class="hljs-number">0</span>;<br>    n-&gt;max_open_zones = <span class="hljs-number">0</span>;<br>    n-&gt;zd_extension_size = <span class="hljs-number">0</span>;<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> NVME_DEFAULT_MAX_AZ_SIZE    (128 * KiB)</span><br></code></pre></td></tr></table></figure>


<h2 id="BUG-kernel-NULL-pointer-dereference-address-0000000000000008"><a href="#BUG-kernel-NULL-pointer-dereference-address-0000000000000008" class="headerlink" title="BUG: kernel NULL pointer dereference, address: 0000000000000008"></a>BUG: kernel NULL pointer dereference, address: 0000000000000008</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><code class="hljs bash">[FEMU] Err: Error IO processed! status is 41b9<br>[  484.444834] BUG: kernel NULL pointer dereference, address: 0000000000000008<br>[  484.460187] <span class="hljs-comment">#PF: supervisor write access in kernel mode</span><br>[  484.460187] <span class="hljs-comment">#PF: error_code(0x0002) - not-present page</span><br>[  484.460187] PGD 0 P4D 0 <br>[  484.460187] Oops: 0002 [<span class="hljs-comment">#1] SMP PTI</span><br>[  484.460187] CPU: 0 PID: 0 Comm: swapper/0 Kdump: loaded Not tainted 5.4.0-148-generic <span class="hljs-comment">#165-Ubuntu</span><br>[  484.460187] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.16.2-0-gea1b7a073390-prebuilt.qemu.org 04/01/2014<br>[  484.460187] RIP: 0010:_raw_spin_lock_irqsave+0x23/0x40<br>[  484.460187] Code: 0f 1f 80 00 00 00 00 0f 1f 44 00 00 55 48 89 e5 41 54 9c 58 0f 1f 44 00 00 49 89 c4 fa 66 0f 1f 44 00 00 31 c0 ba 01 00 00 00 &lt;f0&gt; 0f b1 17 75 07 4c 89 e0 41 5c 5d c3 89 c6 e8 69 1a 60 ff 66 90<br>[  484.460187] RSP: 0018:ffffaef300003dc8 EFLAGS: 00010046<br>[  484.460187] RAX: 0000000000000000 RBX: 0000000000000000 RCX: 0000000000000022<br>[  484.460187] RDX: 0000000000000001 RSI: 0000000000000000 RDI: 0000000000000008<br>[  484.460187] RBP: ffffaef300003dd0 R08: 0000000000000000 R09: 000000000048c586<br>[  484.460187] R10: ffff9fd9699e0900 R11: 0000000000000000 R12: 0000000000000046<br>[  484.460187] R13: 0000000000000000 R14: 000000704a67804f R15: 0000000000000000<br>[  484.660900] FS:  0000000000000000(0000) GS:ffff9fd97ba00000(0000) knlGS:0000000000000000<br>[  484.660900] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033<br>[  484.660900] CR2: 0000000000000008 CR3: 000000012d7e6006 CR4: 0000000000360ef0<br>[  484.660900] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000<br>[  484.660900] DR3: 0000000000000000 DR6: 00000000fffe0ff0 DR7: 0000000000000400<br>[  484.660900] Call Trace:<br>[  484.660900]  &lt;IRQ&gt;<br>[  484.660900]  complete+0x1d/0x50<br>[  484.660900]  blk_end_sync_rq+0x23/0x30<br>[  484.660900]  blk_mq_end_request+0xc7/0x130<br>[  484.660900]  nvme_complete_rq+0x6b/0x1e0 [nvme_core]<br>[  484.660900]  nvme_pci_complete_rq+0xa0/0xd0 [nvme]<br>[  484.660900]  blk_mq_complete_request+0x6c/0xf0<br>[  484.660900]  nvme_irq+0x196/0x26e [nvme]<br>[  484.660900]  ? raw_notifier_call_chain+0x16/0x20<br>[  484.660900]  __handle_irq_event_percpu+0x42/0x180<br>[  484.660900]  handle_irq_event_percpu+0x33/0x80<br>[  484.660900]  handle_irq_event+0x3b/0x60<br>[  484.848098]  handle_edge_irq+0x93/0x1c0<br>[  484.848098]  do_IRQ+0x55/0xf0<br>[  484.848098]  common_interrupt+0xf/0xf<br>[  484.848098]  &lt;/IRQ&gt;<br>[  484.848098] RIP: 0010:native_safe_halt+0xe/0x10<br>[  484.848098] Code: 7b ff ff ff eb bd 90 90 90 90 90 90 e9 07 00 00 00 0f 00 2d 76 15 51 00 f4 c3 66 90 e9 07 00 00 00 0f 00 2d 66 15 51 00 fb f4 &lt;c3&gt; 90 0f 1f 44 00 00 55 48 89 e5 41 55 41 54 53 e8 8d 3b 62 ff 65<br>[  484.848098] RSP: 0018:ffffffff87003e18 EFLAGS: 00000246 ORIG_RAX: ffffffffffffffda<br>[  484.848098] RAX: ffffffff860f9e80 RBX: 0000000000000000 RCX: 0000000000000001<br>[  484.848098] RDX: 000000000004cebe RSI: 0000000000000083 RDI: 0000000000000000<br>[  484.848098] RBP: ffffffff87003e38 R08: 0000007c4831d077 R09: 0000000000022f80<br>[  484.848098] R10: 0000000000100000 R11: 0000000000000000 R12: 0000000000000000<br>[  484.848098] R13: ffffffff87013780 R14: 0000000000000000 R15: 0000000000000000<br>[  484.848098]  ? __cpuidle_text_start+0x8/0x8<br>[  484.848098]  ? tick_nohz_idle_stop_tick+0x13c/0x290<br>[  484.848098]  ? default_idle+0x20/0x140<br>[  484.848098]  arch_cpu_idle+0x15/0x20<br>[  484.848098]  default_idle_call+0x23/0x30<br>[  485.044058]  do_idle+0x1fb/0x270<br>[  485.044058]  cpu_startup_entry+0x20/0x30<br>[  485.044058]  rest_init+0xae/0xb0<br>[  485.044058]  arch_call_rest_init+0xe/0x1b<br>[  485.044058]  start_kernel+0x52f/0x550<br>[  485.044058]  x86_64_start_reservations+0x24/0x26<br>[  485.044058]  x86_64_start_kernel+0x8f/0x93<br>[  485.044058]  secondary_startup_64+0xa4/0xb0<br>[  485.044058] Modules linked <span class="hljs-keyword">in</span>: dm_multipath scsi_dh_rdac scsi_dh_emc scsi_dh_alua binfmt_misc intel_rapl_msr intel_rapl_common kvm_intel kvm rapl ppdev joydev input_leds serio_raw parport_pc parport mac_hid qemu_fw_cfg sch_fq_codel ramoops ry<br>[  485.204063] CR2: 0000000000000008<br>[  485.204063] <span class="hljs-built_in">disable</span> async PF <span class="hljs-keyword">for</span> cpu 0<br>[    0.000000] Linux version 5.4.0-148-generic (buildd@lcy02-amd64-112) (gcc version 9.4.0 (Ubuntu 9.4.0-1ubuntu1~20.04.1)) <span class="hljs-comment">#165-Ubuntu SMP Tue Apr 18 08:53:12 UTC 2023 (Ubuntu 5.4.0-148.165-generic 5.4.231)</span><br>[    0.000000] Command line: BOOT_IMAGE=/boot/vmlinuz-5.4.0-148-generic root=UUID=66add23f-3d34-46f1-a540-ebfdd268827e ro ip=dhcp console=ttyS0,115200 console=<span class="hljs-built_in">tty</span> console=ttyS0 text reset_devices systemd.unit=kdump-tools-dump.service nr_cpus=1 K<br>[    0.000000] KERNEL supported cpus:<br>[    0.000000]   Intel GenuineIntel<br>[    0.000000]   AMD AuthenticAMD<br>[    0.000000]   Hygon HygonGenuine<br>[    0.000000]   Centaur CentaurHauls<br>[    0.000000]   zhaoxin   Shanghai  <br>[    0.000000] x86/fpu: Supporting XSAVE feature 0x001: <span class="hljs-string">&#x27;x87 floating point registers&#x27;</span><br>[    0.000000] x86/fpu: Supporting XSAVE feature 0x002: <span class="hljs-string">&#x27;SSE registers&#x27;</span><br>[    0.000000] x86/fpu: Supporting XSAVE feature 0x004: <span class="hljs-string">&#x27;AVX registers&#x27;</span><br>[    0.000000] x86/fpu: xstate_offset[2]:  576, xstate_sizes[2]:  256<br>[    0.000000] x86/fpu: Enabled xstate features 0x7, context size is 832 bytes, using <span class="hljs-string">&#x27;standard&#x27;</span> format.<br>[    0.000000] BIOS-provided physical RAM map:<br>[    0.000000] BIOS-e820: [mem 0x0000000000000000-0x0000000000000fff] reserved<br>[    0.000000] BIOS-e820: [mem 0x0000000000001000-0x000000000009fbff] usable<br>[    0.000000] BIOS-e820: [mem 0x000000000009fc00-0x000000000009ffff] reserved<br>[    0.000000] BIOS-e820: [mem 0x00000000000f0000-0x00000000000fffff] reserved<br>[    0.000000] BIOS-e820: [mem 0x00000000b3000000-0x00000000bef5cfff] usable<br>[    0.000000] BIOS-e820: [mem 0x00000000befffc00-0x00000000beffffff] usable<br>[    0.000000] BIOS-e820: [mem 0x00000000bffd5000-0x00000000bfffffff] reserved<br>[    0.000000] BIOS-e820: [mem 0x00000000feffc000-0x00000000feffffff] reserved<br>[    0.000000] BIOS-e820: [mem 0x00000000fffc0000-0x00000000ffffffff] reserved<br></code></pre></td></tr></table></figure>

<p>刚开始想简单看一下call trace的后几个函数，猜一下原因</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">wait_queue_head</span> &#123;</span><br>	<span class="hljs-type">spinlock_t</span>		lock;<br>	<span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">list_head</span>	<span class="hljs-title">head</span>;</span><br>&#125;;<br><span class="hljs-keyword">typedef</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">wait_queue_head</span> <span class="hljs-title">wait_queue_head_t</span>;</span><br><br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">completion</span> &#123;</span><br>	<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> done;<br>	<span class="hljs-type">wait_queue_head_t</span> wait;<br>&#125;;<br><br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * blk_end_sync_rq - executes a completion event on a request</span><br><span class="hljs-comment"> * @rq: request to complete</span><br><span class="hljs-comment"> * @error: end I/O status of the request</span><br><span class="hljs-comment"> */</span><br><span class="hljs-type">static</span> <span class="hljs-type">void</span> <span class="hljs-title function_">blk_end_sync_rq</span><span class="hljs-params">(<span class="hljs-keyword">struct</span> request *rq, <span class="hljs-type">blk_status_t</span> error)</span><br>&#123;<br>	<span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">completion</span> *<span class="hljs-title">waiting</span> =</span> rq-&gt;end_io_data;<br><br>	rq-&gt;end_io_data = <span class="hljs-literal">NULL</span>;<br><br>	<span class="hljs-comment">/*</span><br><span class="hljs-comment">	 * complete last, if this is a stack request the process (and thus</span><br><span class="hljs-comment">	 * the rq pointer) could be invalid right after this complete()</span><br><span class="hljs-comment">	 */</span><br>	complete(waiting);<br>&#125;<br><br><span class="hljs-type">void</span> <span class="hljs-title function_">complete</span><span class="hljs-params">(<span class="hljs-keyword">struct</span> completion *x)</span><br>&#123;<br>	<span class="hljs-type">unsigned</span> <span class="hljs-type">long</span> flags;<br><br>	spin_lock_irqsave(&amp;x-&gt;wait.lock, flags);<br><br>	<span class="hljs-keyword">if</span> (x-&gt;done != UINT_MAX)<br>		x-&gt;done++;<br>	__wake_up_locked(&amp;x-&gt;wait, TASK_NORMAL, <span class="hljs-number">1</span>);<br>	spin_unlock_irqrestore(&amp;x-&gt;wait.lock, flags);<br>&#125;<br></code></pre></td></tr></table></figure>
<p>猜某个指针变量为空，而0x8只是指针+偏移量<br>类似于以下程序</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">test</span> &#123;</span><br>  <span class="hljs-type">int</span> a;<br>  <span class="hljs-type">int</span>* b;<br>&#125;;<br><br><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span> &#123;<br>  <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">test</span>* <span class="hljs-title">p</span> =</span> <span class="hljs-literal">NULL</span>;<br>  <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%p %p\n&quot;</span>, p, &amp;(p-&gt;b));<br>&#125;<br><br><span class="hljs-comment">// 输出  (nil) 0x8</span><br></code></pre></td></tr></table></figure>
<p>不过奇怪的是blk_mq_end_request并没有调用blk_end_sync_rq</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">void</span> <span class="hljs-title function_">blk_mq_end_request</span><span class="hljs-params">(<span class="hljs-keyword">struct</span> request *rq, <span class="hljs-type">blk_status_t</span> error)</span><br>&#123;<br>	<span class="hljs-keyword">if</span> (blk_update_request(rq, error, blk_rq_bytes(rq)))<br>		BUG();<br>	__blk_mq_end_request(rq, error);<br>&#125;<br><span class="hljs-keyword">inline</span> <span class="hljs-type">void</span> __blk_mq_end_request(<span class="hljs-keyword">struct</span> request *rq, <span class="hljs-type">blk_status_t</span> error)<br>&#123;<br>	u64 now = <span class="hljs-number">0</span>;<br><br>	<span class="hljs-keyword">if</span> (blk_mq_need_time_stamp(rq))<br>		now = ktime_get_ns();<br><br>	<span class="hljs-keyword">if</span> (rq-&gt;rq_flags &amp; RQF_STATS) &#123;<br>		blk_mq_poll_stats_start(rq-&gt;q);<br>		blk_stat_add(rq, now);<br>	&#125;<br><br>	<span class="hljs-keyword">if</span> (rq-&gt;internal_tag != <span class="hljs-number">-1</span>)<br>		blk_mq_sched_completed_request(rq, now);<br><br>	blk_account_io_done(rq, now);<br><br>	<span class="hljs-keyword">if</span> (rq-&gt;end_io) &#123;<br>		rq_qos_done(rq-&gt;q, rq);<br>		rq-&gt;end_io(rq, error);<br>	&#125; <span class="hljs-keyword">else</span> &#123;<br>		blk_mq_free_request(rq);<br>	&#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p>不知道为什么，内核崩溃并没有触发kdump。</p>
<p>后面想要使用qemu调试内核的方法找到问题原因，使用<a href="https://www.jiasun.top/blog/%E5%86%85%E6%A0%B8%E8%B0%83%E8%AF%95%E5%B7%A5%E5%85%B7crash%E4%BD%BF%E7%94%A8.html">内核调试工具crash使用</a>中apt下载vmlinx，而后执行qemu时加上-S -s选项<br>参考文章：<a target="_blank" rel="noopener" href="https://www.sobyte.net/post/2022-02/debug-linux-kernel-with-qemu-and-gdb/">Debugging Linux kernels with Qemu and GDB</a><br>打断点时一直显示Cannot insert breakpoint，后面想到是不是内核调试选项没有打开<br><img src="https://img-blog.csdnimg.cn/e9b7178966214172b4f2cd6b8a62fc52.png" srcset="/img/loading.gif" lazyload><br>使用make menuconfig时发现各个选项都设置好了<br><img src="https://img-blog.csdnimg.cn/e5784712d77447b1ade73ef17a498969.png" srcset="/img/loading.gif" lazyload><br>按?获取相应选项信息</p>
<p><img src="https://img-blog.csdnimg.cn/e0aefc485c9946d7b96729ac062083eb.png" srcset="/img/loading.gif" lazyload><br><img src="https://img-blog.csdnimg.cn/15f43e9954d5412987a0fb2b8f464d50.png" srcset="/img/loading.gif" lazyload></p>
<p><img src="https://img-blog.csdnimg.cn/67143a0d9e374dab8dae235386cc9bb6.png" srcset="/img/loading.gif" lazyload><br><img src="https://img-blog.csdnimg.cn/4980d49e408d4f90baf3e16d52d7cb00.png" srcset="/img/loading.gif" lazyload><br>就暂时放弃qemu调试内核方法，想要设置其他选项使得kdump正常工作</p>

                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
    <div class="post-meta mr-3 d-flex align-items-center">
      <i class="iconfont icon-category"></i>
      

<span class="category-chains">
  
  
    
      <span class="category-chain">
        
  <a href="/categories/%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/" class="category-chain-item">学习记录</a>
  
  

      </span>
    
  
    
      <span class="category-chain">
        
  <a href="/categories/zns-ssd-femu-nvme-spdk-dpdk/" class="category-chain-item">zns ssd-femu-nvme-spdk-dpdk</a>
  
  

      </span>
    
  
</span>

    </div>
  
  
    <div class="post-meta">
      <i class="iconfont icon-tags"></i>
      
        <a href="/tags/femu-ssd-zns/" class="print-no-link">#femu ssd zns</a>
      
    </div>
  
</div>


              

              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/blog/fio%E5%BC%95%E5%8F%91%E7%9A%84%E4%B8%80%E4%BA%9B%E9%97%AE%E9%A2%98.html" title="fio引发的一些问题">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">fio引发的一些问题</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/blog/leveldb%E8%87%AA%E5%AE%9A%E4%B9%89env.html" title="leveldb自定义env">
                        <span class="hidden-mobile">leveldb自定义env</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
  
  
    <article id="comments" lazyload>
      
  <div id="valine"></div>
  <script type="text/javascript">
    Fluid.utils.loadComments('#valine', function() {
      Fluid.utils.createScript('https://lib.baomitu.com/valine/1.5.1/Valine.min.js', function() {
        var options = Object.assign(
          {"appId":"uU0wegCOTLXqtIgWmhAD3MFq-gzGzoHsz","appKey":"0e2MMh7ddBCGGytOe9UEy5NP","path":"window.location.pathname","placeholder":null,"avatar":"retro","meta":["nick","mail"],"requiredFields":[],"pageSize":10,"lang":"zh-CN","highlight":true,"recordIP":true,"serverURLs":"https://uu0wegco.lc-cn-n1-shared.com","emojiCDN":null,"emojiMaps":null,"enableQQ":false},
          {
            el: "#valine",
            path: window.location.pathname
          }
        )
        new Valine(options);
        Fluid.utils.waitElementVisible('#valine .vcontent', () => {
          var imgSelector = '#valine .vcontent img:not(.vemoji)';
          Fluid.plugins.imageCaption(imgSelector);
          Fluid.plugins.fancyBox(imgSelector);
        })
      });
    });
  </script>
  <noscript>Please enable JavaScript to view the comments</noscript>


    </article>
  


          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header">
    <i class="iconfont icon-list"></i>
    <span>目录</span>
  </p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  


  
  









    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
    </div>
  
  
    <div class="statistics">
  
  

  
    
      <span id="leancloud-site-pv-container" style="display: none">
        总访问量 
        <span id="leancloud-site-pv"></span>
         次
      </span>
    
    
      <span id="leancloud-site-uv-container" style="display: none">
        总访客数 
        <span id="leancloud-site-uv"></span>
         人
      </span>
    
    

  
</div>

  
  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.4/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.20.1/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init(Object.assign({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      scrollSmooth    : true,
      includeTitleTags: true,
      headingsOffset  : -boardTop,
    }, CONFIG.toc));
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }

    Fluid.events.registerRefreshCallback(function() {
      if ('tocbot' in window) {
        tocbot.refresh();
        var toc = jQuery('#toc');
        if (toc.length === 0 || !tocbot) {
          return;
        }
        if (toc.find('.toc-list-item').length > 0) {
          toc.css('visibility', 'visible');
        }
      }
    });
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/4.3.1/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  
      <script>
        if (!window.MathJax) {
          window.MathJax = {
            tex    : {
              inlineMath: { '[+]': [['$', '$']] }
            },
            loader : {
              load: ['ui/lazy']
            },
            options: {
              renderActions: {
                insertedScript: [200, () => {
                  document.querySelectorAll('mjx-container').forEach(node => {
                    let target = node.parentNode;
                    if (target.nodeName.toLowerCase() === 'li') {
                      target.parentNode.classList.add('has-jax');
                    }
                  });
                }, '', false]
              }
            }
          };
        } else {
          MathJax.startup.document.state(0);
          MathJax.texReset();
          MathJax.typeset();
          MathJax.typesetPromise();
        }

        Fluid.events.registerRefreshCallback(function() {
          if ('MathJax' in window && MathJax.startup.document && typeof MathJax.startup.document.state === 'function') {
            MathJax.startup.document.state(0);
            MathJax.texReset();
            MathJax.typeset();
            MathJax.typesetPromise();
          }
        });
      </script>
    

  <script  src="https://lib.baomitu.com/mathjax/3.2.2/es5/tex-mml-chtml.js" ></script>

  <script defer src="/js/leancloud.js" ></script>

  <script  src="/js/local-search.js" ></script>





<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div>
  </noscript>
<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"model":{"jsonPath":"/live2dw/assets/z16.model.json"},"display":{"position":"right","width":200,"height":400},"mobile":{"show":false},"log":false,"pluginJsPath":"lib/","pluginModelPath":"assets/","pluginRootPath":"live2dw/","tagMode":false});</script></body>
</html>
